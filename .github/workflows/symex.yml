name: KLEE Verbosity Test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  klee-verbose:
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 hours
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Install Clang and LLVM
        run: |
          sudo apt-get update
          sudo apt-get install -y clang llvm
          echo "✅ Clang and LLVM installed."

      - name: Compile toy.c to LLVM Bitcode
        run: |
          clang -I/usr/include/klee -emit-llvm -c toy.c -o toy.bc
          echo "✅ toy.c compiled to toy.bc."
          
      - name: Run KLEE in Docker with Maximum Verbosity
        run: |
          # Pull the pre-built KLEE Docker image. (Ensure this image exists or adjust to your image.)
          docker pull klee/klee:latest
          # Run KLEE with verbose SMT logging options.
          docker run --rm -v ${{ github.workspace }}:/workspace klee/klee:latest \
            klee --verbose --write-kqueries /workspace/toy.bc > klee_verbosity.log 2>&1
          echo "✅ KLEE verbose run completed."

      - name: Upload KLEE Verbosity Log
        uses: actions/upload-artifact@v4
        with:
          name: klee-verbosity-log
          path: klee_verbosity.log
